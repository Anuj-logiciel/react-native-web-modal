'use strict';Object.defineProperty(exports,'__esModule',{value:!0}),exports.ReactNativeModal=void 0;var _stringify=require('babel-runtime/core-js/json/stringify'),_stringify2=_interopRequireDefault(_stringify),_objectWithoutProperties2=require('babel-runtime/helpers/objectWithoutProperties'),_objectWithoutProperties3=_interopRequireDefault(_objectWithoutProperties2),_extends2=require('babel-runtime/helpers/extends'),_extends3=_interopRequireDefault(_extends2),_getPrototypeOf=require('babel-runtime/core-js/object/get-prototype-of'),_getPrototypeOf2=_interopRequireDefault(_getPrototypeOf),_classCallCheck2=require('babel-runtime/helpers/classCallCheck'),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require('babel-runtime/helpers/createClass'),_createClass3=_interopRequireDefault(_createClass2),_possibleConstructorReturn2=require('babel-runtime/helpers/possibleConstructorReturn'),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=require('babel-runtime/helpers/inherits'),_inherits3=_interopRequireDefault(_inherits2),_typeof2=require('babel-runtime/helpers/typeof'),_typeof3=_interopRequireDefault(_typeof2),_react=require('react'),_react2=_interopRequireDefault(_react),_reactNativeWeb=require('react-native-web'),_propTypes=require('prop-types'),_propTypes2=_interopRequireDefault(_propTypes),_reactNativeAnimatable=require('react-native-animatable'),_rnWebModal=require('rn-web-modal'),_rnWebModal2=_interopRequireDefault(_rnWebModal),_animations=require('./animations'),ANIMATION_DEFINITIONS=_interopRequireWildcard(_animations),_styles=require('./styles'),_styles2=_interopRequireDefault(_styles);function _interopRequireWildcard(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}(0,_reactNativeAnimatable.initializeRegistryWithDefinitions)(ANIMATION_DEFINITIONS);var makeAnimation=function(a,b){(0,_reactNativeAnimatable.registerAnimation)(a,(0,_reactNativeAnimatable.createAnimation)(b))},isObject=function(a){return null!==a&&'object'===('undefined'==typeof a?'undefined':(0,_typeof3.default)(a))},ReactNativeModal=exports.ReactNativeModal=function(a){function b(a){(0,_classCallCheck3.default)(this,b);var c=(0,_possibleConstructorReturn3.default)(this,(b.__proto__||(0,_getPrototypeOf2.default)(b)).call(this,a));return _initialiseProps.call(c),c.buildAnimations(a),c.state.isSwipeable&&(c.state=(0,_extends3.default)({},c.state,{pan:new _reactNativeWeb.Animated.ValueXY}),c.buildPanResponder()),c.props.isVisible&&(c.state=(0,_extends3.default)({},c.state,{isVisible:!0,showContent:!0})),c}return(0,_inherits3.default)(b,a),(0,_createClass3.default)(b,[{key:'componentWillReceiveProps',value:function b(a){!this.state.isVisible&&a.isVisible&&this.setState({isVisible:!0,showContent:!0}),(this.props.animationIn!==a.animationIn||this.props.animationOut!==a.animationOut)&&this.buildAnimations(a),this.props.backdropOpacity!==a.backdropOpacity&&this.backdropRef&&this.backdropRef.transitionTo({opacity:a.backdropOpacity},this.props.backdropTransitionInTiming)}},{key:'componentDidMount',value:function a(){this.state.isVisible&&this.open()}},{key:'componentWillUnmount',value:function a(){}},{key:'componentDidUpdate',value:function b(a){this.props.isVisible&&!a.isVisible?this.open():!this.props.isVisible&&a.isVisible&&this._close()}},{key:'render',value:function B(){var a=this,b=this.props,c=b.animationIn,d=b.animationInTiming,e=b.animationOut,f=b.animationOutTiming,g=b.avoidKeyboard,h=b.backdropColor,i=b.backdropOpacity,j=b.backdropTransitionInTiming,k=b.backdropTransitionOutTiming,l=b.children,m=b.isVisible,n=b.onModalShow,o=b.onBackdropPress,p=b.onBackButtonPress,q=b.useNativeDriver,r=b.style,s=(0,_objectWithoutProperties3.default)(b,['animationIn','animationInTiming','animationOut','animationOutTiming','avoidKeyboard','backdropColor','backdropOpacity','backdropTransitionInTiming','backdropTransitionOutTiming','children','isVisible','onModalShow','onBackdropPress','onBackButtonPress','useNativeDriver','style']),t=this.state,u=t.deviceWidth,v=t.deviceHeight,w=[{margin:.05*u,transform:[{translateY:0}]},_styles2.default.content,r],x={},y={};this.state.isSwipeable&&(x=(0,_extends3.default)({},this.panResponder.panHandlers),y=this.state.pan.getLayout());var z=this.props.hideModalContentWhileAnimating&&this.props.useNativeDriver&&!this.state.showContent?_react2.default.createElement(_reactNativeAnimatable.View,null):l,A=_react2.default.createElement(_reactNativeAnimatable.View,(0,_extends3.default)({},x,{ref:function c(b){return a.contentRef=b},style:[y,w],pointerEvents:'box-none',useNativeDriver:q},s),z);return _react2.default.createElement(_rnWebModal2.default,(0,_extends3.default)({transparent:!0,animationType:'none',visible:this.state.isVisible,onRequestClose:p},s),_react2.default.createElement(_reactNativeWeb.TouchableWithoutFeedback,{onPress:o},_react2.default.createElement(_reactNativeAnimatable.View,{ref:function c(b){return a.backdropRef=b},useNativeDriver:q,style:[_styles2.default.backdrop,{backgroundColor:this.state.showContent?h:'transparent',width:u,height:v}]})),g&&_react2.default.createElement(_reactNativeWeb.KeyboardAvoidingView,{behavior:'ios'===_reactNativeWeb.Platform.OS?'padding':null,pointerEvents:'box-none',style:w.concat([{margin:0}])},A),!g&&A)}}]),b}(_react.Component);ReactNativeModal.propTypes={animationIn:_propTypes2.default.oneOfType([_propTypes2.default.string,_propTypes2.default.shape]),animationInTiming:_propTypes2.default.number,animationOut:_propTypes2.default.oneOfType([_propTypes2.default.string,_propTypes2.default.shape]),animationOutTiming:_propTypes2.default.number,avoidKeyboard:_propTypes2.default.bool,backdropColor:_propTypes2.default.string,backdropOpacity:_propTypes2.default.number,backdropTransitionInTiming:_propTypes2.default.number,backdropTransitionOutTiming:_propTypes2.default.number,children:_propTypes2.default.node.isRequired,isVisible:_propTypes2.default.bool.isRequired,hideModalContentWhileAnimating:_propTypes2.default.bool,onModalShow:_propTypes2.default.func,onModalHide:_propTypes2.default.func,onBackButtonPress:_propTypes2.default.func,onBackdropPress:_propTypes2.default.func,onSwipe:_propTypes2.default.func,swipeThreshold:_propTypes2.default.number,swipeDirection:_propTypes2.default.oneOf(['up','down','left','right']),useNativeDriver:_propTypes2.default.bool,style:_propTypes2.default.any,scrollTo:_propTypes2.default.func,scrollOffset:_propTypes2.default.number,scrollOffsetMax:_propTypes2.default.number},ReactNativeModal.defaultProps={animationIn:'slideInUp',animationInTiming:300,animationOut:'slideOutDown',animationOutTiming:300,avoidKeyboard:!1,backdropColor:'black',backdropOpacity:.7,backdropTransitionInTiming:300,backdropTransitionOutTiming:300,onModalShow:function a(){return null},onModalHide:function a(){return null},isVisible:!1,hideModalContentWhileAnimating:!1,onBackdropPress:function a(){return null},onBackButtonPress:function a(){return null},swipeThreshold:100,useNativeDriver:!1,scrollTo:null,scrollOffset:0,scrollOffsetMax:0};var _initialiseProps=function(){var a=this;this.state={showContent:!0,isVisible:!1,deviceWidth:_reactNativeWeb.Dimensions.get('window').width,deviceHeight:_reactNativeWeb.Dimensions.get('window').height,isSwipeable:!!this.props.swipeDirection,pan:null},this.transitionLock=null,this.inSwipeClosingState=!1,this.buildPanResponder=function(){var b=null;b='right'===a.props.swipeDirection||'left'===a.props.swipeDirection?_reactNativeWeb.Animated.event([null,{dx:a.state.pan.x}]):_reactNativeWeb.Animated.event([null,{dy:a.state.pan.y}]),a.panResponder=_reactNativeWeb.PanResponder.create({onStartShouldSetPanResponder:function b(){return!(a.props.scrollTo&&0<a.props.scrollOffset)},onPanResponderMove:function g(c,d){var e=a.getAccDistancePerDirection(d),f=1-e/a.state.deviceWidth;if(a.isSwipeDirectionAllowed(d))a.backdropRef&&a.backdropRef.transitionTo({opacity:a.props.backdropOpacity*f}),b(c,d);else if(a.props.scrollTo){var h=-d.dy;h>a.props.scrollOffsetMax&&(h-=(h-a.props.scrollOffsetMax)/2),a.props.scrollTo({y:h,animated:!1})}},onPanResponderRelease:function e(b,c){var d=a.getAccDistancePerDirection(c);return d>a.props.swipeThreshold&&a.props.onSwipe?(a.inSwipeClosingState=!0,void a.props.onSwipe()):void(a.backdropRef&&a.backdropRef.transitionTo({opacity:a.props.backdropOpacity},a.props.backdropTransitionInTiming),_reactNativeWeb.Animated.spring(a.state.pan,{toValue:{x:0,y:0},bounciness:0}).start(),a.props.scrollOffset>a.props.scrollOffsetMax&&a.props.scrollTo({y:a.props.scrollOffsetMax,animated:!0}))}})},this.getAccDistancePerDirection=function(b){switch(a.props.swipeDirection){case'up':return-b.dy;case'down':return b.dy;case'right':return b.dx;case'left':return-b.dx;default:return 0;}},this.isSwipeDirectionAllowed=function(b){var c=b.dy,d=b.dx;return!!('up'===a.props.swipeDirection&&0>c)||!!('down'===a.props.swipeDirection&&0<c)||!!('right'===a.props.swipeDirection&&0<d)||!!('left'===a.props.swipeDirection&&0>d)},this.buildAnimations=function(b){var c=b.animationIn,d=b.animationOut;if(isObject(c)){var e=(0,_stringify2.default)(c);makeAnimation(e,c),c=e}if(isObject(d)){var f=(0,_stringify2.default)(d);makeAnimation(f,d),d=f}a.animationIn=c,a.animationOut=d},this.handleDimensionsUpdate=function(){var b=_reactNativeWeb.Dimensions.get('window').width,c=_reactNativeWeb.Dimensions.get('window').height;(b!==a.state.deviceWidth||c!==a.state.deviceHeight)&&a.setState({deviceWidth:b,deviceHeight:c})},this.open=function(){a.transitionLock||(a.transitionLock=!0,a.backdropRef&&a.backdropRef.transitionTo({opacity:a.props.backdropOpacity},a.props.backdropTransitionInTiming),a.state.isSwipeable&&a.state.pan.setValue({x:0,y:0}),a.contentRef&&a.contentRef[a.animationIn](a.props.animationInTiming).then(function(){a.transitionLock=!1,a.props.isVisible?a.props.onModalShow():a._close()}))},this._close=function(){if(!a.transitionLock){a.transitionLock=!0,a.backdropRef&&a.backdropRef.transitionTo({opacity:0},a.props.backdropTransitionOutTiming);var b=a.animationOut;a.inSwipeClosingState&&(a.inSwipeClosingState=!1,'up'===a.props.swipeDirection?b='slideOutUp':'down'===a.props.swipeDirection?b='slideOutDown':'right'===a.props.swipeDirection?b='slideOutRight':'left'===a.props.swipeDirection&&(b='slideOutLeft')),a.contentRef&&a.contentRef[b](a.props.animationOutTiming).then(function(){a.transitionLock=!1,a.props.isVisible?a.open():(a.setState({showContent:!1},function(){a.setState({isVisible:!1})}),a.props.onModalHide())})}}};exports.default=ReactNativeModal;
//# sourceMappingURL=index.js.map